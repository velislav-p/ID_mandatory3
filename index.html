<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Travel app</title>
    <link type="text/css" rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
</head>
<body>
<!-------------------- HEADER --------------------->
<div class="navbar">
    <ul>
        <li><button id="btn-nav-login">Login</button></li>
        <li><button id="btn-nav-register">Register</button></li>
    </ul>
</div>

<!------------------- SIDE BAR ------------------------->

<div class="sidebar search-form-empty">
    <form>
        <span>From</span>
        <input class="lbl-from" type="text">
        <span>To</span>
        <input class="lbl-to" type="text">
        <span>Departure date</span>
        <input class="lbl-departure" type="text">
        <span>Return date</span>
        <input class="lbl-return" type="text">
        <span>One way</span>
        <input class="lbl-oneWay" name="trip" type="radio" value="One way">
        <span>Round trip</span>
        <input class="lbl-roundTrip" name="trip" type="radio" value="Round trip">
    </form>
    <button class="btn-search-flight">Search for flight</button>
</div>

<div class="sidebar search-form-full">
    <form>
        <span>From</span>
        <span id="lbl-from"></span>
        <span>To</span>
        <span id="lbl-to"></span>
        <span>Departure date</span>
        <span id="lbl-departure"></span>
        <span>Return date</span>
        <span id="lbl-return"></span>
        <span>One way</span>
        <span id="lbl-oneWay"></span>
        <span>Round trip</span>
        <span id="lbl-roundTrip"></span>
    </form>
    <button id="btn-search-flight">Search for flight</button>
</div>

<!------------------ MAIN ------------------------------->

<div class="main">
    <div id="wdw-offers"></div>
    <div id="wdw-search-results" class="wdw">
        <div class="flight">
            <div class="flight-date">Date</div>
            <div class="flight-body">
                <span class="flight-departure-time">23.00</span>
                <i class="fa fa-arrow-right" aria-hidden="true"></i>
                <span class="flight-arrival-time">01.00</span>
            </div>
            <div class="flight-price">230 <span class="currency">DKK</span></div>
        </div>
        <div class="flight">
            <div class="flight-date">Date</div>
            <div class="flight-body">
                <span class="flight-departure-time">23.00</span>
                <i class="fa fa-arrow-right" aria-hidden="true"></i>
                <span class="flight-arrival-time">01.00</span>
            </div>
            <div class="flight-price">230 <span class="currency">DKK</span></div>
        </div>
        <div class="flight">
            <div class="flight-date">Date</div>
            <div class="flight-body">
                <span class="flight-departure-time">23.00</span>
                <i class="fa fa-arrow-right" aria-hidden="true"></i>
                <span class="flight-arrival-time">01.00</span>
            </div>
            <div class="flight-price">230 <span class="currency">DKK</span></div>
        </div>
        <div class="flight">
            <div class="flight-date">Date</div>
            <div class="flight-body">
                <span class="flight-departure-time">23.00</span>
                <i class="fa fa-arrow-right" aria-hidden="true"></i>
                <span class="flight-arrival-time">01.00</span>
            </div>
            <div class="flight-price">230 <span class="currency">DKK</span></div>
        </div>
    </div>
    <div id="wdw-register" class="wdw">register</div>
    <div id="wdw-login" class="wdw">
        <input type="text" id="lbl-username" placeholder="username">
        <input type="text" id="lbl-password" placeholder="password">
        <input type="submit" id="btn-login" value="Log in">
        <div id="login-error-msg"></div>
    </div>
    <div id="wdw-profile" class="wdw">
        <span id="welcome-msg"></span>
    </div>

</div>

<!------------------ REGISTER ------------------------------->

<div class="form-groupRegister">
    <input type="text" id="field-register" placeholder="Please type in the account name you desire">
    <input type="password" id="field-password" placeholder="Type in desired password">
    <button id="btnSubmitRegistration">Submit</button>
</div>
<div id="test">THIS IS A CHANGE</div>
<script>
//--------------- REGISTER ----------------------------------------------
    $("#btnSubmitRegistration").click(function(){

    var fieldRegister = $("#field-register").val();
    var fieldPassword = $("#field-password").val();

    $.ajax({
        "url":"services/register.php",
        cache:false ,
        "method":"post",
        "dataType":"JSON",
        "data":  {"username":fieldRegister , "password": fieldPassword}
    }).done(function () {
        $.ajax({
            "url":"services/login.php" ,
            cache: false , 
            "method":"post",
            "dataType":"JSON" ,
            "data": {"username":fieldRegister, "password":fieldPassword}
        }).done(function () {
            
        })
    })
    });

    $("#btn-nav-login").click(function(){
        $(".wdw").css("display","none");
        $("#wdw-login").css("display","flex");
    });
    $("#btn-nav-register").click(function(){
        $(".wdw").css("display","none");
        $("#wdw-register").css("display","flex");
    });
//--------------- LOGIN ---------------------------------------------------
    $("#btn-login").click(function(){
        var username = $("#lbl-username").val();
        var password = $("#lbl-password").val();
        $.ajax({
            "url":"services/login.php",
            "method":"post",
            "data":{"username":username,"password":password},
            "dataType":"JSON",
            "cache":false
        }).done(function(jData){
            if(jData.status == "ok"){
                displayProfile(jData);
            }else{
                $("#login-error-msg").text("No such user found");
            }
        })
    });
//--------------- DISPLAY PROFILE ---------------------------------------------------
    function displayProfile(jData){
        $(".wdw").css("display","none");
        $("#wdw-profile").css("display","flex");
        $("#welcome-msg").text("Hello "+jData.username);
        $(".navbar").empty().append("<button id='btn-logout'>Logout</button>");
    }
//--------------- BUTTON CLICKS -----------------------------------------------------
    $("#btn-search-flight").click(function(){
        $("#wdw-search-results").css("display","flex");
    });

    $(document).on("click","#btn-logout",function(){
        $.ajax({
            "url":"services/logout.php",
            "method":"get"
        }).done(function(){
            $(".wdw").css("display","none");
            $("#wdw-offers").css("display","flex");
            $(".nav-button").css("display","flex");
            $("#btn-logout").css("display","none");
        })
    });
    $(".btn-search-flight").click(function() {
        var from = $(".lbl-from").val();
        var to = $(".lbl-to").val();
        var depDate = $(".lbl-departure").val();
        var arrDate = $(".lbl-return").val();
        var tripType = document.querySelector('input[name="trip"]:checked').value;

        $("#lbl-from").append(from);
    })

</script>
</body>

</html>