<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Travel app</title>
    <link type="text/css" rel="stylesheet" href="style/style.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway:300,400,500,700,800" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
</head>
<body>
<!-------------------- HEADER --------------------->
<div class="navbar">
        <h5 id="welcome-msg"></h5>
        <button id="btn-nav-login" class="nav-button btn btn-success">Login</button>
        <button id="btn-nav-register" class="nav-button btn btn-success">Register</button>
        <button id='btn-logout' class='btn btn-success'>Logout</button>
</div>

<!------------------- SIDE BAR ------------------------->

<div class="sidebar search-form-empty">
    <span>From</span>
    <input class="lbl-from form-control" type="text">
    <span>To</span>
    <input class="lbl-to form-control" type="text">
    <span>Departure date</span>
    <input class="lbl-departure form-control" type="text">
    <span>Return date</span>
    <input class="lbl-return form-control" type="text">
    <span>One way</span>
    <input class="lbl-oneWay" name="trip" type="radio" value="One way">
    <span>Round trip</span>
    <input class="lbl-roundTrip" name="trip" type="radio" value="Round trip">
    <button class="btn-search-flight btn btn-warning">Search for flight</button>
</div>

<div class="sidebar search-form-full">
    <span><strong>From</strong></span>
    <span id="lbl-from"></span>
    <span><strong>To</strong></span>
    <span id="lbl-to"></span>
    <span><strong>Departure date</strong></span>
    <span id="lbl-departure"></span>
    <span><strong>Return date</strong></span>
    <span id="lbl-return"></span>
    <span id="lbl-trip-type"></span>
    <div id="flight-details">
        <div id="departureTime"></div>
        <div id="arrivalTime"></div>
        <div id="price"></div>

    </div>
    <button id="btn-change-search-details" class="btn btn-warning">Change details</button>
    <button class="btn btn-warning" id="btn-changeFlight">Change Flight</button>
</div>

<!------------------ MAIN ------------------------------->

<div class="main">

    <div id="wdw-search-results" class="wdw">

        <div class="flight">
            <div class="flight-date"><h4>We suggest :</h4></div>
            <div class="flight-body">
                <span class="flight-departure-time">Departure : 18.00</span>
                <i class="fa fa-arrow-right" aria-hidden="true"></i>
                <span class="flight-arrival-time">Arrival : 01.00</span>
            </div>
            <div class="flight-price">290 <span class="currency">DKK</span></div>
        </div>
        <div class="flight">
            <div class="flight-date"><h4>We suggest :</h4></div>
            <div class="flight-body">
                <span class="flight-departure-time">Departure : 09.00</span>
                <i class="fa fa-arrow-right" aria-hidden="true"></i>
                <span class="flight-arrival-time">Arrival : 16.00</span>
            </div>
            <div class="flight-price">410 <span class="currency">DKK</span></div>
        </div>
        <div class="flight">
            <div class="flight-date"><h4>We suggest :</h4></div>
            <div class="flight-body">
                <span class="flight-departure-time">Departure : 14.00</span>
                <i class="fa fa-arrow-right" aria-hidden="true"></i>
                <span class="flight-arrival-time">Arrival : 21.00</span>
            </div>
            <div class="flight-price">730 <span class="currency">DKK</span></div>
        </div>
        <div class="flight">
            <div class="flight-date"><h4>We suggest :</h4></div>
            <div class="flight-body">
                <span class="flight-departure-time">Departure : 21.00</span>
                <i class="fa fa-arrow-right" aria-hidden="true"></i>
                <span class="flight-arrival-time">Arrival : 05.00</span>
            </div>
            <div class="flight-price">570 <span class="currency">DKK</span></div>
        </div>
    </div>
    <div id="wdw-register" class="wdw basic-form">
        <input type="text" id="field-register" class="form-control" placeholder="Please type in the account name you desire">
        <input type="password" id="field-password" class="form-control" placeholder="Type in desired password">
        <input type="submit" id="btn-registration" class="btn btn-warning" value="Register">
    </div>
    <div id="wdw-login" class="wdw basic-form">
        <input type="text" id="lbl-username" class="form-control" placeholder="username">
        <input type="text" id="lbl-password" class="form-control" placeholder="password">
        <input type="submit" id="btn-login" class="btn btn-warning" value="Log in">
        <div id="login-error-msg"></div>
    </div>
    <div id="wdw-profile" class="wdw">
        <h1>Your payment details</h1>
        <div class="wdw-profile-details-saved">
            <div>No payment details saved.</div>
        </div>
        <button id="btn-save-payment-details" class="btn btn-success">Save payment details</button>
        <div class="wdw-profile-details-form wdw">
            <form>
                <div class="wdw-payment-InputArea">
                    <label>Write your Name:</label>
                    <input type="text" class="paymentName form-control">
                </div>
                <div class="wdw-payment-InputArea">
                    <label>Write your Surname:</label>
                    <input type="text" class="paymentSurname form-control">
                </div>
                <div class="wdw-payment-InputArea">
                    <label>Write your E-mail here:</label>
                    <input type="text" class="paymentEmail form-control">
                </div>
                <div class="wdw-payment-InputArea">
                    <label>Please type you company CVR here if available:</label>
                    <input type="text" class="paymentCVR form-control">
                </div>
                <div class="wdw-payment-InputArea">
                    <label>Enter you're credit card number here:</label>
                    <input type="text" class="paymentCreditCardNumber form-control">
                </div>
                <div class="wdw-payment-InputArea">
                    <label>Enter you're credit cards expiration date:</label>
                    <input type="text" class="paymentCreditCardDate form-control">
                </div>
                <div class="wdw-payment-InputArea">
                    <label>Enter the security number found on the back of your card:</label>
                    <input type="text" class="paymentCreditCardCVV form-control">
                </div>
                <div class="wdw-payment-InputArea">
                    <label>In the field below type in your address:</label>
                    <input type="text" class="paymentAddress form-control">
                </div>
                <div class="wdw-payment-InputArea">
                    <input type="button" class="btn btn-warning" id="btn-save-payment" value="Submit!">
                </div>
            </form>
        </div>
    </div>
    <div class="wdw-payment wdw">
        <input type="submit" id="btn-autofill" class="btn btn-success" value="Autofill">
        <form>
            <div class="wdw-payment-InputArea">
                <label>Write your Name:</label>
                <input type="text" class="paymentName form-control">
            </div>
            <div class="wdw-payment-InputArea">
                <label>Write your Surname:</label>
                <input type="text" class="paymentSurname form-control">
            </div>
            <div class="wdw-payment-InputArea">
                <label>Write your E-mail here:</label>
                <input type="text" class="paymentEmail form-control">
            </div>
            <div class="wdw-payment-InputArea">
                <label>Please type you company CVR here if available:</label>
                <input type="text" class="paymentCVR form-control" >
            </div>
            <div class="wdw-payment-InputArea">
                <label>Enter you're credit card number here:</label>
                <input type="text" class="paymentCreditCardNumber form-control">
            </div>
            <div class="wdw-payment-InputArea">
                <label>Enter you're credit cards expiration date:</label>
                <input type="text" class="paymentCreditCardDate form-control">
            </div>
            <div class="wdw-payment-InputArea">
                <label>Enter the security number found on the back of your card:</label>
                <input type="text" class="paymentCreditCardCVV form-control">
            </div>
            <div class="wdw-payment-InputArea">
                <label>In the field below type in your address:</label>
                <input type="text" class="paymentAddress form-control">
            </div>
            <div class="wdw-payment-InputArea">
                <input type="button" class="btn btn-warning" id="btn-complete-payment" value="Submit!">
            </div>
        </form>

    </div>
    <div id="wdw-receipt" class="wdw">
        <h3>Congratulations! Your booking is complete</h3>
        <h4>We have sent you an email with the following information</h4>
        <div id="receipt-user-details">
            <h3>Personal details</h3>
            <div id="receipt-name"><strong>Name: </strong></div>
            <div id="receipt-email"><strong>Email: </strong></div>
            <div id="receipt-address"><strong>Address: </strong></div>
            <div id="receipt-cvr"><strong>CVR: </strong></div>
        </div>
        <div id="receipt-flight-details">
            <h3>Flight details</h3>
            <div id="receipt-booking-number"><strong>Booking reference:</strong> Z7JS34A</div>
            <div id="receipt-trip-to"><strong>Flying from: </strong></div>
            <div id="receipt-trip-from"><strong>Flying to: </strong></div>
            <div id="receipt-dep-date"><strong>Date of departure: </strong></div>
            <div id="receipt-arr-date"><strong>Date of arrival: </strong></div>
            <div id="receipt-trip-type"><strong>Trip: </strong></div>
            <div id="receipt-plane-number"><strong>Aircraft type: </strong>BOEING 747</div>
            <div id="receipt-seat-number"><strong>Seat:</strong> 13A</div>
        </div>
    </div>
</div>

<!------------------------JAVA---------------------->
<script>
    //--------------- REGISTER ----------------------------------------------

    $("#btn-registration").click(function(){

        var fieldRegister = $("#field-register").val();
        var fieldPassword = $("#field-password").val();
        //console.log("x");

        $.ajax({
            "url":"services/register.php",
            cache:false ,
            "method":"post",
            "dataType":"JSON",
            "data":  {"username":fieldRegister , "password": fieldPassword}
        }).done(function (jData) {

            displayProfile(jData);

        })
    });

    $("#btn-nav-login").click(function(){
        $(".wdw").css("display","none");
        $("#wdw-login").css("display","flex");
        $(".sidebar").css("order","3");
        $(".main").css("order","2");

    });

    $("#btn-nav-register").click(function(){
        $(".wdw").css("display","none");
        $("#wdw-register").css("display","flex");
        $(".sidebar").css("order","3");
        $(".main").css("order","2");
    });
    //--------------- LOGIN ---------------------------------------------------

    $("#btn-login").click(function(){
        var username = $("#lbl-username").val();
        var password = $("#lbl-password").val();

        $.ajax({
            "url":"services/login.php",
            "method":"post",
            "data":{"username":username,"password":password},
            "dataType":"JSON",
            "cache":false
        }).done(function(jData){
            if(jData.status == "ok"){
                displayProfile(jData);
                $(".search-form-full").append("<button id='btn-resume-booking' class='btn btn-warning'>Resume booking</button>")

            }else{
                $("#login-error-msg").text("No such user found");
            }
        })
    });

    //--------------- DISPLAY PROFILE ---------------------------------------------------

    function displayProfile(jData){
        $(".wdw").css("display","none");
        $("#wdw-profile").css("display","flex");
        $("#welcome-msg").text("Hello "+jData.username);
        $(".nav-button").css("display","none");
        $("#btn-logout").css("display","flex");
        $.ajax({
            "url": "services/retrieve-details.php",
            "method": "POST",
            "data": {"username": jData.username},
            "dataType":"json"
        }).done(function (jDataNew) {
            $(".wdw-profile-details-saved").empty().append("<div>Name: " + jDataNew.username + " " + jDataNew.surname + "</div><div>Email: " + jDataNew.email + "</div><div>CVR: " + jDataNew.cvr + "</div>\
              <div>Credit card number: " + jDataNew.creditCardNumber + "</div><div>Address: " + jDataNew.address + "</div>");
        });
    }
    //--------------- BUTTON CLICKS -----------------------------------------------------

    $(document).on("click","#welcome-msg",function() {
      var jData = {"username":name};
      displayProfile(jData);
    });

    $(document).on("click","#btn-logout",function(){
        $.ajax({
            "url":"services/logout.php",
            "method":"get"
        }).done(function(){
            $(".wdw").css("display","none");
            $(".main").css("order","3");
            $(".search-form-empty").css("display","flex");
            $(".search-form-full").css("display","none");
            $(".nav-button").css("display","inline");
            $("#btn-logout").css("display","none");
            $("#welcome-msg").empty();
        })
    });
    var from;
    var to;
    var depDate;
    var arrDate;
    var tripType;
    $(".btn-search-flight").click(function() {
        from = $(".lbl-from").val();
        to = $(".lbl-to").val();
        depDate = $(".lbl-departure").val();
        arrDate = $(".lbl-return").val();
        tripType = document.querySelector('input[name="trip"]:checked').value;
        $(".sidebar").css("order","2");
        $(".main").css("order","3");
        $(".search-form-empty").css("display","none");
        $(".search-form-full").css("display","flex");
        $(".wdw").hide();
        $("#wdw-search-results").css("display","flex");
        $("#lbl-from").append(from);
        $("#lbl-to").append(to);
        $("#lbl-departure").append(depDate);
        $("#lbl-return").append(arrDate);
        $("#lbl-trip-type").append(tripType);
        $("#btn-changeFlight").hide();


    });

    $(".flight").click(function(){
        var depTime = $(this).find('.flight-departure-time').text();
        var arrTime = $(this).find('.flight-arrival-time').text();
        var price = $(this).find('.flight-price').text();

        $("#departureTime").append("<strong>Departure time: </strong><span>"+depTime+"</span>");
        $("#arrivalTime").append("<strong>Arrival time: </strong><span>"+arrTime+"</span>");
        $("#price").append("<strong>Price:</strong> <span>"+price+"</span>");

        $(".wdw").hide();
        $(".wdw-payment").css("display","flex");
        $("#btn-changeFlight").css("display","inline-block  ");
    });

    $("#btn-save-payment-details").click(function(){
        $(".wdw-profile-details-form").css("display","flex");
    });
    var name;
    var surname;
    var email;
    var cvr;
    var address;
    $("#btn-save-payment").click(function() {
        name = $(".paymentName").val();
        surname = $(".paymentSurname").val();
        email = $(".paymentEmail").val();
        cvr = $(".paymentCVR").val();
        var creditCardNumber = $(".paymentCreditCardNumber").val();
        var creditCardCvv = $(".paymentCreditCardCVV").val();
        var creditCardDate = $(".paymentCreditCardDate").val();
        address = $(".paymentAddress").val();

        $(".wdw-profile-details-form").css("display","none");
        $.ajax({
            "url": "services/save-details.php",
            "method": "POST",
            "data": {
                "username": name,
                "surname": surname,
                "email": email,
                "cvr": cvr,
                "creditCardNumber": creditCardNumber,
                "creditCardCvv": creditCardCvv,
                "creditCardDate": creditCardDate,
                "address": address
            }
        }).done(function (jData) {
            $(".wdw-profile-details-saved").empty().append("<div>Name: " + name + " " + surname + "</div><div>Email: " + email + "</div><div>CVR: " + cvr + "</div>\
              <div>Credit card number: " + creditCardNumber + "</div><div>Address: " + address + "</div>");
        });
    });

    $("#btn-change-search-details").click(function() {
        $(".search-form-empty").css("display","flex");
        $(".search-form-full").css("display","none");
        $("#wdw-search-results").css("display","none");
        $("#lbl-trip-type").empty();
        $("#lbl-return").empty();
        $("#lbl-from").empty();
        $("#lbl-to").empty();
        $("#lbl-departure").empty();
        $("#departureTime").empty();
        $("#arrivalTime").empty();
        $("#price").empty();
    });

    $("#btn-complete-payment").click(function(){
        $(".wdw").hide();
        $("#wdw-receipt").css("display","flex");
        $(".sidebar").hide();

        $("#receipt-name").append(name);
        $("#receipt-email").append(email);
        $("#receipt-address").append(address);
        $("#receipt-cvr").append(cvr);
        $("#receipt-trip-to").append(to);
        $("#receipt-trip-from").append(from);
        $("#receipt-dep-date").append(depDate);
        $("#receipt-arr-date").append(arrDate);
        $("#receipt-trip-type").append(tripType);
    });


    $("#btn-changeFlight").click(function () {

        $(".wdw").hide();
        $("#wdw-search-results").css("display","flex");
        $("#departureTime").empty();
        $("#arrivalTime").empty();
        $("#price").empty();
        $("#btn-changeFlight").hide();

    });

    $("#btn-autofill").click(function(){
        console.log("hello");
        $.ajax({
            "url":"services/retrieve-details.php",
            "method":"GET",
            "data":{"username":name},
            "dataType":"JSON"
        }).done(function(jData){
            console.log(jData);
            if(jData.status == "error"){
                $(".wdw-payment").prepend("<div>You have not filled in payment details</div>");
            } else {
                $(".paymentName").val(jData.username);
                $(".paymentSurname").val(jData.surname);
                $(".paymentEmail").val(jData.email);
                $(".paymentCVR").val(jData.cvr);
                $(".paymentCreditCardDate").val(jData.creditCardDate);
                $(".paymentCreditCardNumber").val(jData.creditCardNumber);
                $(".paymentCreditCardCVV").val(jData.creditCardCvv);
                $(".paymentAddress").val(jData.address);
            }
        }).fail(function(jData){
            console.log(jData);
        })
    });
    $(document).on("click","#btn-resume-booking",function(){
        $(".wdw").hide();
        $("#wdw-search-results").css("display","flex");
        $(this).css("display","none");
    })

</script>
</body>

</html>
